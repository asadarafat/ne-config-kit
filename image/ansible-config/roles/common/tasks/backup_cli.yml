---
- name: Build CLI command list
  ansible.builtin.set_fact:
    _cli_commands: >-
      {{
        backup_command
        if (backup_command is iterable and (backup_command is not string))
        else [backup_command]
      }}

- name: Collect running config via CLI
  ansible.netcommon.cli_command:
    command: "{{ item }}"
  loop: "{{ _cli_commands }}"
  register: cli_result
  check_mode: false

- name: Resolve CLI stdout
  ansible.builtin.set_fact:
    _cli_stdout: >-
      {{
        (cli_result.results[-1].stdout if (cli_result.results is defined and cli_result.results | length > 0) else cli_result.stdout)
      }}

- name: Set raw config from CLI output
  ansible.builtin.set_fact:
    raw_config: "{{ (_cli_stdout | first) if (_cli_stdout is iterable and (_cli_stdout is not string)) else _cli_stdout }}"
