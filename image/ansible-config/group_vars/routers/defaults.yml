---
# Common defaults for router devices. Override per host/group as needed.

# Credentials (no plaintext in repo). Prefer Vault, SSH keys, or env vars.
ansible_user: >-
  {{ (vault_ansible_user | default(lookup('env', 'ANSIBLE_NET_USERNAME'), true))
     | default(omit, true) }}
ansible_password: >-
  {{ (vault_ansible_password | default(lookup('env', 'ANSIBLE_NET_PASSWORD'), true))
     | default(omit, true) }}
ansible_ssh_private_key_file: "{{ lookup('env', 'ANSIBLE_NET_SSH_KEY') | default(omit, true) }}"
ansible_become: false
ansible_ssh_common_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"

# Backup and restore defaults
backup_transport: cli            # cli | netconf | httpapi | scp
backup_command: "show running-config"
backup_root: "/nck-backups"
backup_filename: "running.conf"
# Optional archive filename template. Supports tokens:
# <clab_lab_name>, <ne_name>, <time-stamp>
backup_filename_template: "<clab_lab_name>__<ne_name>__<time-stamp>.conf"
backup_timestamp: ""
backup_write_latest: true

# Normalization patterns remove volatile lines to reduce churn
normalize_patterns:
  - '^! Last configuration change.*'
  - '^! NVRAM config last updated.*'
  - '^! Time:.*'
  - '^Building configuration.*'
  - '^Current configuration.*'
  - '^! No configuration change since last restart.*'
  - '^#.*timestamp.*'
  - '^!.*Generated.*'
  - '^!.*Last modified.*'
  - '^: .*'
normalize_strip_empty: true

# NETCONF options
netconf_source: running
netconf_filter: null

# HTTP API options (generic REST/RESTCONF)
httpapi_base_url: ""
httpapi_backup_path: ""
httpapi_restore_path: ""
httpapi_backup_method: "GET"
httpapi_backup_body: null
httpapi_backup_body_format: "raw"
httpapi_backup_expected_status: 200
httpapi_restore_method: "PUT"
httpapi_restore_body: null
httpapi_restore_body_format: "raw"
httpapi_restore_expected_status: 200
httpapi_response_format: "text"   # text | json
httpapi_response_jmespath: null
httpapi_headers: {}
httpapi_validate_certs: true
httpapi_force_basic_auth: true

# SCP options
scp_port: 22
scp_remote_path: ""
scp_backup_path: ""
scp_restore_path: ""
scp_username: "{{ ansible_user | default(omit, true) }}"
scp_password: "{{ ansible_password | default(omit, true) }}"
scp_private_key: "{{ ansible_ssh_private_key_file | default(omit, true) }}"
scp_extra_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"
scp_no_log: true

# Legacy aliases (kept for compatibility)
httpapi_body_format: "raw"
httpapi_expected_status: 200

# CLI restore tuning
cli_config_replace: "line"
cli_diff_match: "line"
cli_save_when: "never"

# Audit behavior
audit_show_diff: true
audit_fail_on_drift: true
audit_cleanup_temp: true

# Restore safety
restore_verify: true
