{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ne-config-kit configuration",
  "type": "object",
  "additionalProperties": false,
  "patternProperties": {
    "^x-": {
      "$ref": "#/$defs/anyJson"
    }
  },
  "anyOf": [
    { "required": ["clab_lab_name"] },
    { "required": ["clab_inventory"] }
  ],
  "properties": {
    "clab_lab_name": {
      "type": "string",
      "minLength": 1,
      "description": "Containerlab lab name used to derive /clab/clab-<name>/ansible-inventory.yml."
    },
    "clab_inventory": {
      "type": "string",
      "minLength": 1,
      "description": "Explicit path to an Ansible inventory file."
    },
    "target_hosts": {
      "$ref": "#/$defs/stringOrStringArray",
      "description": "Ansible host pattern or list of patterns."
    },
    "clab_kind": {
      "type": "string",
      "minLength": 1,
      "description": "Override the kind resolution when inventory groups do not match credentials."
    },
    "ansible_ssh_common_args": {
      "type": "string",
      "default": "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null",
      "description": "Additional SSH arguments for network_cli connections."
    },
    "backup_transport": {
      "type": "string",
      "enum": ["cli", "netconf", "httpapi", "scp"],
      "description": "Transport used for backup/restore."
    },
    "backup_root": {
      "type": "string",
      "minLength": 1,
      "default": "/nck-backups",
      "description": "Root directory for backups."
    },
    "backup_filename": {
      "type": "string",
      "minLength": 1,
      "default": "running.conf",
      "description": "Filename for each host backup."
    },
    "backup_filename_template": {
      "type": "string",
      "default": "<clab_lab_name>__<ne_name>__<time-stamp>.conf",
      "description": "Optional archive filename template. Tokens: <clab_lab_name>, <ne_name>, <time-stamp>."
    },
    "backup_timestamp": {
      "type": "string",
      "description": "Override the generated timestamp when using backup_filename_template."
    },
    "backup_write_latest": {
      "type": "boolean",
      "description": "Write a stable backup_filename alongside the template archive."
    },
    "backup_write": {
      "type": "boolean",
      "description": "Skip writing backup files when false (used by audit)."
    },
    "normalize_patterns": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Regex patterns to strip from configs."
    },
    "normalize_strip_empty": {
      "type": "boolean",
      "description": "Collapse excessive blank lines after normalization."
    },
    "audit_show_diff": {
      "type": "boolean",
      "description": "Show diff output during audit when drift is detected."
    },
    "audit_cleanup_temp": {
      "type": "boolean",
      "description": "Remove temporary diff files after audit."
    },
    "audit_fail_on_drift": {
      "type": "boolean",
      "description": "Fail the audit play when drift is detected."
    },
    "restore_verify": {
      "type": "boolean",
      "description": "Run audit after restore to verify state."
    },
    "backup_command": {
      "$ref": "#/$defs/stringOrStringArray",
      "description": "CLI command(s) used to collect running config."
    },
    "cli_config_replace": {
      "type": "string",
      "description": "cli_config replace strategy."
    },
    "cli_diff_match": {
      "type": "string",
      "description": "cli_config diff_match strategy."
    },
    "cli_save_when": {
      "type": "string",
      "description": "cli_config save_when strategy."
    },
    "cli_restore_method": {
      "type": "string",
      "enum": ["cli_config", "line_by_line"],
      "description": "CLI restore method. Use line_by_line for devices that require config mode/commit."
    },
    "cli_restore_pre_commands": {
      "$ref": "#/$defs/stringOrStringArray",
      "description": "Commands to run before line-by-line CLI restore."
    },
    "cli_restore_post_commands": {
      "$ref": "#/$defs/stringOrStringArray",
      "description": "Commands to run after line-by-line CLI restore."
    },
    "netconf_source": {
      "type": "string",
      "description": "NETCONF source datastore."
    },
    "netconf_filter": {
      "$ref": "#/$defs/anyJson",
      "description": "Optional NETCONF filter."
    },
    "httpapi_base_url": {
      "type": "string",
      "minLength": 1,
      "description": "Base URL for HTTP API calls."
    },
    "httpapi_backup_path": {
      "type": "string",
      "minLength": 1,
      "description": "HTTP API path used to collect config."
    },
    "httpapi_restore_path": {
      "type": "string",
      "minLength": 1,
      "description": "HTTP API path used to restore config."
    },
    "httpapi_backup_method": {
      "type": "string",
      "description": "HTTP method for backup."
    },
    "httpapi_restore_method": {
      "type": "string",
      "description": "HTTP method for restore."
    },
    "httpapi_backup_body": {
      "$ref": "#/$defs/anyJson",
      "description": "HTTP API request body for backups."
    },
    "httpapi_restore_body": {
      "$ref": "#/$defs/anyJson",
      "description": "HTTP API request body for restores."
    },
    "httpapi_backup_body_format": {
      "type": "string",
      "description": "Body format for backup requests."
    },
    "httpapi_restore_body_format": {
      "type": "string",
      "description": "Body format for restore requests."
    },
    "httpapi_body_format": {
      "type": "string",
      "description": "Fallback body format for HTTP API requests."
    },
    "httpapi_backup_expected_status": {
      "$ref": "#/$defs/statusCode",
      "description": "Expected status code for backup requests."
    },
    "httpapi_restore_expected_status": {
      "$ref": "#/$defs/statusCode",
      "description": "Expected status code for restore requests."
    },
    "httpapi_expected_status": {
      "$ref": "#/$defs/statusCode",
      "description": "Fallback expected status code for HTTP API requests."
    },
    "httpapi_response_format": {
      "type": "string",
      "description": "Response format: text or json."
    },
    "httpapi_response_jmespath": {
      "type": ["string", "null"],
      "description": "JMESPath expression for JSON responses."
    },
    "httpapi_headers": {
      "type": "object",
      "additionalProperties": { "type": "string" },
      "description": "HTTP headers for API calls."
    },
    "httpapi_validate_certs": {
      "type": "boolean",
      "description": "Enable TLS certificate validation."
    },
    "httpapi_force_basic_auth": {
      "type": "boolean",
      "description": "Force basic auth for HTTP API calls."
    },
    "httpapi_username": {
      "type": "string",
      "description": "HTTP API username override."
    },
    "httpapi_password": {
      "type": "string",
      "description": "HTTP API password override."
    },
    "scp_port": {
      "type": "integer",
      "minimum": 1,
      "maximum": 65535,
      "description": "SCP port."
    },
    "scp_remote_path": {
      "type": "string",
      "description": "Remote path to the config file."
    },
    "scp_backup_path": {
      "type": "string",
      "description": "Remote path used for backup."
    },
    "scp_restore_path": {
      "type": "string",
      "description": "Remote path used for restore."
    },
    "scp_username": {
      "type": "string",
      "description": "SCP username override."
    },
    "scp_password": {
      "type": "string",
      "description": "SCP password override."
    },
    "scp_private_key": {
      "type": "string",
      "description": "SCP private key path."
    },
    "scp_extra_args": {
      "type": "string",
      "description": "Extra SCP arguments."
    },
    "scp_no_log": {
      "type": "boolean",
      "description": "Hide SCP commands from logs."
    },
    "clab_kind_credentials": {
      "type": "object",
      "additionalProperties": { "$ref": "#/$defs/credential" },
      "description": "Credentials keyed by containerlab kind."
    },
    "clab_host_credentials": {
      "type": "object",
      "additionalProperties": { "$ref": "#/$defs/credential" },
      "description": "Host-specific credential overrides."
    }
  },
  "$defs": {
    "stringOrStringArray": {
      "anyOf": [
        { "type": "string" },
        {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        }
      ]
    },
    "statusCode": {
      "anyOf": [
        { "type": "integer" },
        {
          "type": "array",
          "items": { "type": "integer" },
          "minItems": 1
        }
      ]
    },
    "credential": {
      "type": "object",
      "minProperties": 1,
      "additionalProperties": false,
      "properties": {
        "username": { "type": "string" },
        "password": { "type": "string" }
      }
    },
    "anyJson": {
      "type": ["object", "array", "string", "number", "boolean", "null"]
    }
  }
}
